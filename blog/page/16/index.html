
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Philippe Bourgau's blog</title>
  <meta name="author" content="Philippe Bourgau">

  
  <meta name="description" content="A programming blog. Particularly about agile development, real world walkthrough, tutorials, side project entrepreneurship and open source software.">

  
  <meta name="keywords" content="blog, programming, ruby, coffeescript, c#, java, agile, extreme programming, xp, kanban, scrum, tdd, testing, unit testing">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://philippe.bourgau.net/blog/page/16/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="http://feeds.feedburner.com/PhilippeBourgau" rel="alternate" title="Philippe Bourgau's blog" type="application/atom+xml">
  <link href="/stylesheets/asides.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/banner.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/tables.css" media="screen, projection" rel="stylesheet" type="text/css" />
<link href="/stylesheets/images.css" rel="stylesheet" type="text/css">

<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=Raleway:100" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Lora:400,400italic,700,700italic|Istok+Web:400,400italic,700,700italic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Shadows+Into+Light" rel="stylesheet" type="text/css" />

<meta name="google-translate-customization" content="799b363844424d98-0fe595ed0d0bb43c-g68c635d8080c4daa-14"></meta>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-30589315-1', 'auto', {'allowLinker': true});
  ga('send', 'pageview');
  ga('require', 'linker');
  ga('linker:autoLink', ['agileavatars.com']);
</script>

<!-- tables css -->

  

</head>

<body>
  <div id="header-container">
    <div id="header">
      <div class="wrapper">
        <header role="banner"><hgroup>
  <h1><a href="/">Philippe Bourgau's blog</a></h1>
</hgroup>

</header>
        <nav role="navigation"><ul class="subscription" data-subscription="rss email">
  <li><a href="http://feeds.feedburner.com/PhilippeBourgau" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
    <li><a href="https://feedburner.google.com/fb/a/mailverify?uri=PhilippeBourgau&amp;loc=en_US" rel="subscribe-email" title="subscribe via email">Email</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:philippe.bourgau.net" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
      </div>
    </div>
  </div>
  <div id="body"   >
    <div id="main">
      <div id="content">
	<div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/stubmodel-and-mockmodel/">Stub_model and Mock_model</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-16T00:00:00+02:00" pubdate data-updated="true">Apr 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I decided to stop using stub_model and mock_model. I do not use them enough to get fluent with them. Everytime I have to deal with them, something breaks in an unexpected way. I just decided to stand with good old stubs.</p>


<p>I am also thinking of switching to RR (double ruby) and to use proxy objects to get simplify mocking even further. Did you try it ?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/including-railsapplicationroutesurlhelpers-fr/">Including Rails.application.routes.url_helpers From a Module</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-04-16T00:00:00+02:00" pubdate data-updated="true">Apr 16<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When I migrated from rails 2.0 to rails 3.0, I had to change inclusion of ActionController::UrlWriter to&nbsp;Rails.application.routes.url_helpers. I started to get strange errors like</p>


<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">undefined</span> <span class="s1">&#39;default_url_options&#39;</span>
</span></code></pre></td></tr></table></div></figure>
</p>


<p>when running my specs. The issue was that I was including a module himself including&nbsp;Rails.application.routes.url_helpers.</p>


<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">PathBarHelper</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">include</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">url_helpers</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>
</p>


<p>As if at module definition time, url_helpers was not yet completly ready. I changed the code to include url helpers through a hook :</p>


<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">module</span> <span class="nn">PathBarHelper</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">included</span><span class="p">(</span><span class="n">base</span><span class="p">)</span>
</span><span class='line'>   <span class="n">base</span><span class="o">.</span><span class="n">send</span> <span class="ss">:include</span> <span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">url_helpers</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="o">.</span><span class="n">.</span><span class="o">.</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>
</p>


<p>That did the trick, but I must admit I did not dig the issue completly. Tell me if you did ?</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/how-to-mock-an-out-of-process-com-server-with/">How to Mock an Out of Process COM Server With C#</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-02-14T00:00:00+01:00" pubdate data-updated="true">Feb 14<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am currently working to replace a legacy command line front end on a COM out of process server.</p>


<p>This server is written in C++ and communicates with the front end through COM. For our new front end project, we wanted a standalone integration test harness to run end to end tests. I thought it would have been great to use a mock library (like <a href="http://code.google.com/p/moq/">moq</a>) to validate the interaction between the front end and the COM server.</p>


<p>After searching the web, I tried ServicedComponent but I did not manage to make it work &#8230; I then found <a href="http://support.microsoft.com/kb/977996">How to develop and out-of-process COM component by using Visual C#</a>&nbsp;in microsoft knowledge base. It is a full blown COM server completly written in C#.</p>


<p>After downloading it, the first thing I tried was to return a mock instead of a concrete object in the class factory</p>


<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'>   <span class="c1">// CSSimpleObject.cs</span>
</span><span class='line'>   <span class="k">internal</span> <span class="k">class</span> <span class="nc">CSSimpleObjectClassFactory</span> <span class="p">:</span> <span class="n">IClassFactory</span>
</span><span class='line'>   <span class="p">{</span>
</span><span class='line'>      <span class="k">public</span> <span class="kt">int</span> <span class="nf">CreateInstance</span><span class="p">(</span><span class="n">IntPtr</span> <span class="n">pUnkOuter</span><span class="p">,</span> <span class="k">ref</span> <span class="n">Guid</span> <span class="n">riid</span><span class="p">,</span> <span class="k">out</span> <span class="n">IntPtr</span> <span class="n">ppvObject</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>         <span class="p">...</span>
</span><span class='line'>         <span class="k">if</span> <span class="p">(</span><span class="n">riid</span> <span class="p">==</span> <span class="k">new</span> <span class="n">Guid</span><span class="p">(</span><span class="n">CSSimpleObject</span><span class="p">.</span><span class="n">ClassId</span><span class="p">)</span> <span class="p">||</span>
</span><span class='line'>            <span class="n">riid</span> <span class="p">==</span> <span class="k">new</span> <span class="n">Guid</span><span class="p">(</span><span class="n">COMNative</span><span class="p">.</span><span class="n">IID_IDispatch</span><span class="p">)</span> <span class="p">||</span>
</span><span class='line'>            <span class="n">riid</span> <span class="p">==</span> <span class="k">new</span> <span class="n">Guid</span><span class="p">(</span><span class="n">COMNative</span><span class="p">.</span><span class="n">IID_IUnknown</span><span class="p">))</span>
</span><span class='line'>         <span class="p">{</span>
</span><span class='line'>            <span class="c1">// Create the instance of the .NET object</span>
</span><span class='line'>            <span class="kt">var</span> <span class="n">simpleObject</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&amp;</span><span class="n">lt</span><span class="p">;</span><span class="n">CSSimpleObject</span><span class="p">&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="p">{</span><span class="n">CallBase</span> <span class="p">=</span> <span class="k">true</span><span class="p">};</span>
</span><span class='line'>            <span class="n">simpleObject</span><span class="p">.</span><span class="n">SetupGet</span><span class="p">(</span><span class="n">x</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">x</span><span class="p">.</span><span class="n">FloatProperty</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="m">666</span><span class="p">);</span>
</span><span class='line'>            <span class="n">simpleObject</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&amp;</span><span class="n">gt</span><span class="p">;</span> <span class="n">x</span><span class="p">.</span><span class="n">HelloWorld</span><span class="p">()).</span><span class="n">Returns</span><span class="p">(</span><span class="s">&quot;Hello, you got pwned !!!&quot;</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">ppvObject</span> <span class="p">=</span> <span class="n">Marshal</span><span class="p">.</span><span class="n">GetComInterfaceForObject</span><span class="p">(</span>
</span><span class='line'>               <span class="n">simpleObject</span><span class="p">.</span><span class="n">Object</span><span class="p">,</span> <span class="k">typeof</span><span class="p">(</span><span class="n">ICSSimpleObject</span><span class="p">));</span>
</span><span class='line'>            <span class="p">}</span>
</span><span class='line'>            <span class="p">...</span>
</span></code></pre></td></tr></table></div></figure>
</p>


<p>Launching&nbsp;CSExeCOMClient.vbs test program told me that it worked.</p>


<p>So here is how I eventually integrated this in our test harness :</p>


<ul>
<li>I ran tlbimp.exe on the real COM server I wanted to mock</li>
<li>In CSSimpleObject.cs, I returned a Mock on the interface of the COM component I wanted to mock</li>
<li>In&nbsp;CSSimpleObject.cs, I removed SimpleObjectsXXX types</li>
<li>To skip registration and to keep access on the returned mock, I started this mock COM server in a new thread at the begining of each test</li>
<li>I tested our new front end in a new process, to make sure we would go through out-of-process COM communication</li>
</ul>


<p>Edit:</p>


<p>We discovered a problem with this technique when we did not manage to implement events correctly. The problem is with COM and not with the mocking framework because it does not work with a real implementation neither</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/using-stock-ruby-with-rbenv/">Using Stock Ruby With Rbenv</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-26T00:00:00+01:00" pubdate data-updated="true">Jan 26<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While migrating to ruby 1.9, I started using rbenv. I was wondering how it would handle my stock ubuntu ruby 1.8. It works out of the box with the rbenv &#8220;system&#8221; version. I just have to run</p>


<p>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'>rbenv global system
</span></code></pre></td></tr></table></div></figure>
</p>


<div>to come back to my stock ruby. Great !</div>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/devise-ssl-requirements-and-post-data/">Devise, SSL Requirements and Post Data</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-25T00:00:00+01:00" pubdate data-updated="true">Jan 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I am using rails 2.3.8, devise 1.0.11 and ssl_requirements 0.1.0. I am having strange behaviour when mixing devise with ssl_requirements. When a form posts to an action that is required to be ssl, the post is redirected to ssl as a get, and looses its post data !</p>


<p>To workaround the problem, I had to require ssl for the form itself aswell.</p>


<p>I hope the situation will be better once I migrate to rails 3 and to newer versions of devise and ssl_requirements.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/scaling-agile/">Scaling Agile</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-19T00:00:00+01:00" pubdate data-updated="true">Jan 19<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>I have worked in small agile teams, and it does indeed work a lot better than the classical waterfall &amp; hierarchic environment. When speaking with other people who have been through the same experience,&nbsp;we started to wonder how could this be scaled to a big organization ?</p>


<p>I read two good books on the subject from Craig Larman and Bas Vodde:</p>


<ul>
<li>
<div><span><a href="http://www.amazon.com/Scaling-Lean-Agile-Development-Organizational/dp/0321480961/ref=sr_1_1?tag=pbourgau-20&amp;s=books&amp;ie=UTF8&amp;qid=1326974242&amp;sr=1-1">Scaling Lean &amp; Agile Development: Thinking and Organizational Tools for Large-Scale Scrum</a></span></div>
</li>
<li>
<div><span><a href="http://www.amazon.com/Practices-Scaling-Lean-Agile-Development/dp/0321636406/ref=sr_1_2?tag=pbourgau-20&amp;s=books&amp;ie=UTF8&amp;qid=1326974242&amp;sr=1-2">Practices for Scaling Lean &amp; Agile Development: Large, Multisite, and Offshore Product Development with Large-Scale Scrum</a></span></div>
</li>
</ul>


<p>There made a lot of good points and techniques, but it&nbsp;still sounded a bit theorical. Later&nbsp;I read <a href="http://producingoss.com/">&#8220;Producing Open Source Software&#8221;</a>&nbsp;from Karl Fogel. At first,&nbsp;it did not seem to&nbsp;have any link with scaling agile, but successfull open source projects have to&nbsp;handle distributed developpment&nbsp;and&nbsp;high turnover, so I thought that maybe large&nbsp;agile organizations have something to learn from open source developpment mechanics. Why wouldn&#8217;t these technics that are successful at sharing code between companies be used internaly to share code between teams ?</p>


<p>At the same time, at work, I learnt the hard way that I should avoid to work for a &#8220;library, framework, engine &#8230;&#8221; team. It&#8217;s both frustrating and&nbsp;unrewarding :</p>


<ul>
<li>
<div>You never really understand what you are working for, what is the final goal</div>
</li>
<li>
<div>You are always doing a poor job at priorizing requests from different sponsors</div>
</li>
<li>
<div>You are doing too much on some areas, but too few on others</div>
</li>
</ul>


<p>Agile &amp; incremental development and architecture solves this the nice&nbsp;way, by extract framework and libraries from running software ! Successful open source projects often start&nbsp;like that&nbsp;(<a href="http://rubyonrails.org/">Rails</a> being the cannonical example).</p>


<p>So why couldn&#8217;t we just let libraries and framework emerge&nbsp;the same way inside a company ? Why don&#8217;t we maintain these projects as we would maintain an open source project : as a side product of&nbsp;our main output ?</p>


<p>Craig Larman and Bas Vodde speak of feature teams, 20% free time, communities : all this fits nicely with this idea. Suppose we could&nbsp;have 20%&nbsp;of our time to work on what we like, any developper could take&nbsp;this time to extract a library from his team&#8217;s codebase and promote it as a company library, he could become dictator in chief as long as he wishes to. Other teams could reuse it and submit patches. All of the time proven open source developpment best practices could be used.</p>


<p>Edit: <a href="http://zachholman.com/talk/how-github-uses-github-to-build-github/">Github builds Github</a> with something a lot like this !</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/a-nice-place-to-find-free-pictures-for-my-web/">A Useful Link to Find Free Pictures</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-11T00:00:00+01:00" pubdate data-updated="true">Jan 11<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>While I was looking for photos for an article on&nbsp; <a href="http://www.mes-courses.fr/blog">blog for mes-courses.fr</a>, I found this site : <a href="http://www.photo-libre.fr">http://www.photo-libre.fr</a>. There are a lot of pictures, both &euro; free and royalties free. All that is asked for is a backing to <a href="http://www.photo-libre.fr/">http://www.photo-libre.fr</a>.</p>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/order-of-execution-of-before-blocks-in-rspec/">Order of Execution of Before Blocks in RSpec</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-01-05T00:00:00+01:00" pubdate data-updated="true">Jan 5<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><p>I discovered that before blocks in RSpec&rsquo;s examples are executed in the order they are declared. There is no great deal about it, but it can be useful when using shared examples.<br />In rspec 1.3.8, it is possible to simulate shared examples with parameters by using instance variables instead. This is were it gets useful to know the order of evaluation of before blocks. As an example :<p />
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">shared_example_for</span> <span class="s2">&quot;anything&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">before</span> <span class="ss">:each</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@thing</span><span class="o">.</span><span class="n">should_not</span> <span class="n">be_nil</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="n">describe</span> <span class="s2">&quot;A monkey wrench&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">it_should_behave_like</span> <span class="s2">&quot;anything&quot;</span>
</span><span class='line'>   <span class="n">before</span> <span class="ss">:each</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@thing</span> <span class="o">=</span> <span class="no">MonkeyWrench</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>
<p />The previous example will fail, whereas the next one will succeed.<p />
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">describe</span> <span class="s2">&quot;A monkey wrench&quot;</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">before</span> <span class="ss">:each</span> <span class="k">do</span>
</span><span class='line'>    <span class="vi">@thing</span> <span class="o">=</span> <span class="no">MonkeyWrench</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  <span class="n">it_should_behave_like</span> <span class="s2">&quot;anything&quot;</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>
<p />That is the before blocks nested in shared examples still evaluate in the order of declaration.</p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/how-to-test-a-class-using-an-implementation-h/">How to Test a Class Using an Implementation Helper ?</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-12-14T00:00:00+01:00" pubdate data-updated="true">Dec 14<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><p>Suppose you have some duplicated code in the Foo &amp; Bar classes. You managed to extracted this code in an helper class. Fine, the helper class can now be tested on its own, but how do I get rid of duplication in FooTest and BarTest ?<p />I though of injecting a mock on the helper class in Foo &amp; Bar when testing, to make sure the helper instance is correctly used, but sometimes, it just feel as if testing an implementation &hellip;<p />Here is what we eventually did at work : create an abstract base class to test the api of the helper class. Implement this abstract class once to test the helper class itself, and then implement it once each time it is reused.<p />Here is an exemple with a ListBuilder helper class that wraps a list and returns a copy of it each time it is asked for.<p />
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ListBuilder</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n"><em>internalList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;();</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n"></em>listSnapshot</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;();</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">readonly</span> <span class="kt">object</span> <span class="n"><em>locker</span> <span class="p">=</span> <span class="k">new</span> <span class="kt">object</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">ListSnapshot</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">lock</span> <span class="p">(</span><span class="n"></em>locker</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n"><em>listSnapshot</span><span class="p">.</span><span class="n">Count</span> <span class="p">!=</span> <span class="n"></em>internalList</span><span class="p">.</span><span class="n">Count</span><span class="p">)</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>        <span class="n"><em>listSnapshot</span> <span class="p">=</span> <span class="k">new</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;(</span><span class="n"></em>internalList</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n"><em>listSnapshot</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">Add</span><span class="p">(</span><span class="n">T</span> <span class="n">newItem</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">lock</span> <span class="p">(</span><span class="n"></em>locker</span><span class="p">)</span>
</span><span class='line'>    <span class="p">{</span>
</span><span class='line'>      <span class="n"><em>internalList</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">newItem</span><span class="p">);</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
<p />Here is the tests for ListBuilder class itself<p />
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="k">public</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">ListBuilderContractTest</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">AddAnItem</span><span class="p">();</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">abstract</span> <span class="k">void</span> <span class="nf">VerifyAddedItem</span><span class="p">(</span><span class="n">T</span> <span class="n">addedItem</span><span class="p">);</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">abstract</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">T</span><span class="p">&gt;</span> <span class="n">ListCopy</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">TheDefaultListShouldBeEmpty</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">ListCopy</span><span class="p">().</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">AddShouldAddItemInList</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">AddAnItem</span><span class="p">();</span>
</span><span class='line'>    <span class="n">VerifyItemWasAdded</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">void</span> <span class="nf">VerifyItemWasAdded</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">copy</span> <span class="p">=</span> <span class="n">ListCopy</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="n">copy</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>    <span class="n">VerifyAddedItem</span><span class="p">(</span><span class="n">copy</span><span class="p">[</span><span class="m">0</span><span class="p">]);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">WhenOfSameSizeNewListCopyShoulReturnSameList</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">AddAnItem</span><span class="p">();</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreSame</span><span class="p">(</span><span class="n">ListCopy</span><span class="p">(),</span> <span class="n">ListCopy</span><span class="p">());</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">CopiesShouldBeSnapshots</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="kt">var</span> <span class="n">copy</span> <span class="p">=</span> <span class="n">ListCopy</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">AssertExecution</span><span class="p">.</span><span class="n">Of</span><span class="p">(</span><span class="n">AddAnItem</span><span class="p">)</span>
</span><span class='line'>      <span class="p">.</span><span class="n">ShouldNotChange</span><span class="p">(()</span> <span class="p">=&gt;</span> <span class="n">copy</span><span class="p">.</span><span class="n">Count</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">ListBuilderTest</span> <span class="p">:</span> <span class="n">ListBuilderContractTest</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="k">const</span> <span class="kt">string</span> <span class="n">ADDED_ITEM</span> <span class="p">=</span> <span class="s">&quot;toto&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">private</span> <span class="n">ListBuilder</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n"></em>appender</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"><em>appender</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ListBuilder</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">AddAnItem</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"></em>appender</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">ADDED_ITEM</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">VerifyAddedItem</span><span class="p">(</span><span class="kt">string</span> <span class="n">addedItem</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n">ADDED_ITEM</span><span class="p">,</span> <span class="n">addedItem</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">List</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">&gt;</span> <span class="n">ListCopy</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n"><em>appender</span><span class="p">.</span><span class="n">ListSnapshot</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
<p />And here are tests for other class using it. First a simple one :<p />
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">OrderPresenterAsExecListBuilderTest</span> <span class="p">:</span> <span class="n">ListBuilderContractTest</span><span class="p">&lt;</span><span class="n">IExecRowPresenter</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">OrderPresenter</span> <span class="n"></em>presenter</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IExec</span><span class="p">&gt;</span> <span class="n"><em>exec</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"></em>exec</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IExec</span><span class="p">&gt;();</span>
</span><span class='line'>    <span class="n"><em>exec</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="s">&quot;an exec&quot;</span><span class="p">);</span>
</span><span class='line'>    <span class="n"></em>exec</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Price</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="m">123.456</span><span class="p">);</span>
</span><span class='line'>    <span class="n"><em>exec</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Quantity</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="m">36</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n"></em>presenter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">OrderPresenter</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">AddAnItem</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"><em>presenter</span><span class="p">.</span><span class="n">AddExec</span><span class="p">(</span><span class="n"></em>exec</span><span class="p">.</span><span class="n">Object</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">VerifyAddedItem</span><span class="p">(</span><span class="n">IExecRowPresenter</span> <span class="n">addedItem</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n"><em>exec</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">addedItem</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n"></em>exec</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Price</span><span class="p">,</span> <span class="n">addedItem</span><span class="p">.</span><span class="n">Price</span><span class="p">);</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n"><em>exec</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Quantity</span><span class="p">,</span> <span class="n">addedItem</span><span class="p">.</span><span class="n">Quantity</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IExecRowPresenter</span><span class="p">&gt;</span> <span class="n">ListSnapshot</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n"></em>presenter</span><span class="p">.</span><span class="n">GraphicalExecs</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
<p />Then a more complex one :<p />
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='c#'><span class='line'><span class="na">[TestFixture]</span>
</span><span class='line'><span class="k">public</span> <span class="k">class</span> <span class="nc">StrategyPresenterAsOrderPresenterListBuilderTest</span> <span class="p">:</span> <span class="n">ListBuilderContractTest</span><span class="p">&lt;</span><span class="n">IOrderPresenter</span><span class="p">&gt;</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">StrategyPresenter</span> <span class="n"><em>presenter</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IStrategy</span><span class="p">&gt;</span> <span class="n"></em>strategy</span><span class="p">;</span>
</span><span class='line'>  <span class="k">private</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IOrder</span><span class="p">&gt;</span> <span class="n"><em>order</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="na">  [SetUp]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">SetUp</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"></em>strategy</span><span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IStrategy</span><span class="p">&gt;</span> <span class="p">{</span> <span class="n">DefaultValue</span> <span class="p">=</span> <span class="n">DefaultValue</span><span class="p">.</span><span class="n">Mock</span> <span class="p">};</span>
</span><span class='line'>
</span><span class='line'>    <span class="n"><em>order</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Mock</span><span class="p">&lt;</span><span class="n">IOrder</span><span class="p">&gt;();</span>
</span><span class='line'>    <span class="n"></em>order</span><span class="p">.</span><span class="n">Setup</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">Id</span><span class="p">).</span><span class="n">Returns</span><span class="p">(</span><span class="m">123</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n"><em>presenter</span> <span class="p">=</span> <span class="k">new</span> <span class="n">StrategyPresenter</span><span class="p">(</span><span class="n"></em>strategy</span><span class="p">.</span><span class="n">Object</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">AddAnItem</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"><em>strategy</span><span class="p">.</span><span class="n">Raise</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">SentQuantityChanged</span> <span class="p">+=</span> <span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="n">SentQuantityChangedEventArgs</span> <span class="p">{</span><span class="n">Origin</span> <span class="p">=</span> <span class="n"></em>order</span><span class="p">.</span><span class="n">Object</span><span class="p">});</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="k">void</span> <span class="nf">VerifyAddedItem</span><span class="p">(</span><span class="n">IOrderPresenter</span> <span class="n">addedItem</span><span class="p">)</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n">Assert</span><span class="p">.</span><span class="n">AreEqual</span><span class="p">(</span><span class="n"><em>order</span><span class="p">.</span><span class="n">Object</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">addedItem</span><span class="p">.</span><span class="n">Id</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">protected</span> <span class="k">override</span> <span class="n">List</span><span class="p">&lt;</span><span class="n">IOrderPresenter</span><span class="p">&gt;</span> <span class="n">ListSnapshot</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n"></em>presenter</span><span class="p">.</span><span class="n">GraphicalOrderList</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="na">  [Test]</span>
</span><span class='line'>  <span class="k">public</span> <span class="k">void</span> <span class="nf">ExecutedQuantityChangedShouldAddAnItem</span><span class="p">()</span>
</span><span class='line'>  <span class="p">{</span>
</span><span class='line'>    <span class="n"><em>strategy</span><span class="p">.</span><span class="n">Raise</span><span class="p">(</span><span class="n">x</span> <span class="p">=&gt;</span> <span class="n">x</span><span class="p">.</span><span class="n">ExecutedQuantityChanged</span> <span class="p">+=</span> <span class="k">null</span><span class="p">,</span> <span class="k">new</span> <span class="n">ExecutedQuantityChangedEventArgs</span> <span class="p">{</span><span class="n">Origin</span> <span class="p">=</span> <span class="n"></em>order</span><span class="p">.</span><span class="n">Object</span><span class="p">});</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">VerifyItemWasAdded</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>
<p />The solution really pleases me :<p />&nbsp;&nbsp;&nbsp; No code duplication<br />&nbsp;&nbsp;&nbsp; Robust tests<br />&nbsp;&nbsp;&nbsp; No artificial mocking<p /></p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/external-gem-rails-generator-not-found/">External Gem Rails Generator Not Found</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2011-11-24T00:00:00+01:00" pubdate data-updated="true">Nov 24<span>th</span>, 2011</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>When trying to use devise 1.0.11 with rails 2.3.8 and bundler 1.0.10, I got the error &quot;could not find generator &hellip;&quot; when running bundle exec script/generate devise_install &hellip; After reading <a href="http://stackoverflow.com/questions/3366508/couldnt-find-devise-install-generator-rails-2-3-8-devise-1-0-8" target="_blank"><a href="http://stackoverflow.com/questions/3366508/couldnt-find-devise-install-generator-rails-2-3-8-devise-1-0-8">http://stackoverflow.com/questions/3366508/couldnt-find-devise-install-generator-rails-2-3-8-devise-1-0-8</a></a> I ended up copying the file manually !<p /> I hope this is fixed in rails 3, I am looking forward to migrate.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/17/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/15/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <div id="google_translate_element"></div>
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({pageLanguage: 'en', includedLanguages: 'fr', layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL, gaTrack: true, gaId: 'UA-30589315-1'}, 'google_translate_element');
    }
  </script>
  <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</section>
<section>
	<span>
		<img src="http://www.gravatar.com/avatar/686399bd630ecc9381e4dfec8720816e?s=260" alt="Gravatar of Philippe Bourgau " title="Gravatar of Philippe Bourgau" />
	</span>
</section>
<section>
  <h1>About Me</h1>
  <p>Philippe Bourgau, Happiness and Productivity Hacker</p>
  <p>Officialy, Developer</p>
  <p>Currently, developer, architect, manager & agile coach in my risk engine team at <a href="http://www.murex.com">Murex</a>; self proclaimed change agent in the company; serial side project builder at night; devoted family guy.</p>
  <ul>
    <li><a href="http://www.linkedin.com/pub/philippe-bourgau/8/a92/607">Linkedin profile</li></a>
    <li><a href="https://dl.dropbox.com/u/206938/cv%20philippe%20bourgau.pdf">Resume</a></li>
  </ul>
</section>
<section>
  <h1>Open Source Projects</h1>
  <ul>
    <li><a href="http://philous-planning-poker.herokuapp.com">Philou&#8217;s Planning Poker</a> : Better poker estimates for remote teams ! (In Progress)</li>
    <li><a href="/storexplore">Storexplore</a> : Transform online stores into APIs !</li>
    <li><a href="/rspecproxies">RSpecProxies</a> : Simplify RSpec mocking with test proxies !</li>
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/philou">@philou</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'philou',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/dont-stick-to-tdds-red-green-refactor-loop-to-the-letter/">Don&#8217;t stick to TDD&#8217;s Red-Green-Refactor loop to the letter</a>
      </li>
    
      <li class="post">
        <a href="/13-tricks-for-successful-side-projects/">13 Tricks for Successful Side Projects</a>
      </li>
    
      <li class="post">
        <a href="/side-projects-matter/">Side Projects Matter</a>
      </li>
    
      <li class="post">
        <a href="/speed-up-the-tdd-feedback-loop-with-better-assertion-messages/">Speed up the TDD feedback loop with better assertion messages</a>
      </li>
    
      <li class="post">
        <a href="/20-bad-excuses-for-not-writing-unit-tests/">20 Bad Excuses For Not Writing Unit Tests</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Friend&#8217;s blogs</h1>
  <ul>
    <li><img class="logo link" src="https://avatars2.githubusercontent.com/u/40221?v=3&s=24" /><a href="https://abailly.github.io/">Arnaud Bailly&#8217;s blog</a></li>
    <li><img class="logo link" src="https://www.murex.com/sites/default/files/favicon.ico" /> <a href="http://www.murex.com/">Murex (my company)</a></li>
    <li><img class="logo link" src="https://avatars0.githubusercontent.com/u/2824069?v=3&s=24" /><a href="http://tpierrain.blogspot.fr/">Thomas&#8217; blog</a></li>
    <li><img class="logo link" src="https://avatars3.githubusercontent.com/u/11088496?v=3&s=24" /><a href="https://ahmadatwi.me/">Ahmad Atwi&#8217;s blog</a></li>
    <li><img class="logo link" src="http://bilal.eltayara.net/favicon.png" /><a href="http://bilal.eltayara.net/">Bilal El Tayara&#8217;s blog</a></li>
    <li><img class="logo link" src="http://sthiery.blogspot.fr/favicon.ico" /><a href="http://sthiery.blogspot.fr/">Sylvain&#8217;s blog (french)</a></li>
    <li><img class="logo link" src="https://avatars2.githubusercontent.com/u/732436?v=3&s=24" /><a href="http://www.pgourlain.fr/">Pierrick&#8217;s website (french)</a></li>
  </ul>
</section>




  
</aside>

      </div>
    </div>
    <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Philippe Bourgau -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a>. Design by <a href="http://octopressthemes.com">Octopress Themes</a>.</span>
</p>

</footer>
    

<script type="text/javascript">
      var disqus_shortname = 'philippe-bourgau';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>



  <script type="text/javascript">
    (function() {
      var script = document.createElement('script'); script.type = 'text/javascript'; script.async = true;
      script.src = 'https://apis.google.com/js/plusone.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(script, s);
    })();
  </script>



  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





  </div>
</body>
</html>
