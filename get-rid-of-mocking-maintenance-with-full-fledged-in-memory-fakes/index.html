<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Get rid of mock maintenance with full fledged in-memory fakes | Philippe Bourgau’s XP Coaching Blog</title>
<meta name="description" content="Example showing how it is simpler to use a full fledged in-memory mock than using a custom mock for every test. Illustrated with Ruby on Rails code examples.">


  <meta name="author" content="Philippe Bourgau">
  
  <meta property="article:author" content="Philippe Bourgau">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Philippe Bourgau's XP Coaching Blog">
<meta property="og:title" content="Get rid of mock maintenance with full fledged in-memory fakes">
<meta property="og:url" content="https://philippe.bourgau.net/get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/">


  <meta property="og:description" content="Example showing how it is simpler to use a full fledged in-memory mock than using a custom mock for every test. Illustrated with Ruby on Rails code examples.">



  <meta property="og:image" content="https://philippe.bourgau.net/imgs/2018-05-28-get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/in-memory-fake.jpg">



  <meta name="twitter:site" content="@pbourgau">
  <meta name="twitter:title" content="Get rid of mock maintenance with full fledged in-memory fakes">
  <meta name="twitter:description" content="Example showing how it is simpler to use a full fledged in-memory mock than using a custom mock for every test. Illustrated with Ruby on Rails code examples.">
  <meta name="twitter:url" content="https://philippe.bourgau.net/get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://philippe.bourgau.net/imgs/2018-05-28-get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/in-memory-fake.jpg">
  

  



  <meta property="article:published_time" content="2018-05-31T19:15:00+00:00">





  

  


<link rel="canonical" href="https://philippe.bourgau.net/get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Philippe Bourgau",
      "url": "https://philippe.bourgau.net/",
      "sameAs": ["https://twitter.com/pbourgau","https://www.linkedin.com/in/philippe-bourgau-607a928/","https://github.com/philou","https://www.youtube.com/channel/UCq6uOPvSmpQeVrLRCQOQ8KQ"]
    
  }
</script>







<!-- end _includes/seo.html -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Philippe Bourgau's XP Coaching Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single-mailing-list">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
        <a class="site-title" href="/">
          Philippe Bourgau's XP Coaching Blog
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about-me/">About Me</a>
            </li><li class="masthead__menu-item">
              <a href="/services/">Services</a>
            </li><li class="masthead__menu-item">
              <a href="/speaking/">Speaking</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/">Categories</a>
            </li><li class="masthead__menu-item">
              <a href="/archives/">Archives</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="http://www.gravatar.com/avatar/686399bd630ecc9381e4dfec8720816e?s=260" alt="Philippe Bourgau" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Philippe Bourgau</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Software Development Coach</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Paris, France</span>
        </li>
      

      
        
          
        
          
            <li><a href="/about-me" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span></a></li>
          
        
          
            <li><a href="https://twitter.com/pbourgau" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://github.com/philou" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/philippe-bourgau-607a928" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
        
          
            <li><a href="https://www.youtube.com/channel/UCq6uOPvSmpQeVrLRCQOQ8KQ" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-youtube" aria-hidden="true"></i><span class="label">YouTube</span></a></li>
          
        
          
            <li><a href="https://www.eventstormingjournal.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-sticky-note" aria-hidden="true"></i><span class="label">Event Storming Journal</span></a></li>
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Get rid of mock maintenance with full fledged in-memory fakes">
    <meta itemprop="description" content="Last week’s post was about how hexagonal architecture results in fast, mock-free tests around your core domain. Unfortunately, that does not remove all mocks, yet it groups them in the same, less critical, zone. In last week’s code sample, this was the controller. I concluded that at least, this was easier to manage. Let’s see how.">
    <meta itemprop="datePublished" content="2018-05-31T19:15:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Get rid of mock maintenance with full fledged in-memory fakes
</h1>
          

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


        </header>
      

      <section class="page__content" itemprop="text">
        
        <p><a href="https://philippe.bourgau.net/avoid-mocks-and-test-your-core-domain-faster-with-hexagonal-architecture/">Last week’s post</a> was about how <a href="http://alistair.cockburn.us/Hexagonal+architecture">hexagonal architecture</a> results in fast, mock-free tests around your core domain. Unfortunately, that does not remove all mocks, yet it groups them in the same, less critical, zone. In last week’s code sample, this was the controller. I concluded that at least, this was easier to manage. Let’s see how.</p>

<p><img src="https://philippe.bourgau.net/imgs/2018-05-28-get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/in-memory-fake.jpg" alt="Hand written 'In-memory fake' with memory replaced by a RAM board" /></p>

<p>This is the 7th post in <a href="https://philippe.bourgau.net/categories/#how-to-avoid-mocks-series">a series about avoiding mocks</a>. If you haven’t, you might start from <a href="https://philippe.bourgau.net/careless-mocking-considered-harmful/">the beginning</a>.</p>

<h2 id="mock-concentration">Mock concentration</h2>

<p>Let’s get back to the <a href="https://philippe.bourgau.net/avoid-mocks-and-test-your-core-domain-faster-with-hexagonal-architecture/">last post</a>’s code sample. As a reminder, it’s a very basic TODO app built on <a href="https://rubyonrails.org/">Rails</a>. I extracted the domain part, the tasks, in a core domain area. This allowed to push all mocks out of this section. A consequence though, is that all mocks gathered in the controller test. Here is the controller code :</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'core/task'</span>
<span class="nb">require</span> <span class="s1">'infrastructure/task_repo'</span>

<span class="k">class</span> <span class="nc">TasksController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="err"> </span><span class="n">before_action</span> <span class="ss">:set_task</span><span class="p">,</span> <span class="ss">only: </span><span class="p">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="p">]</span>

<span class="err"> </span><span class="c1"># GET /tasks</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">index</span>
<span class="err">   </span><span class="vi">@tasks</span> <span class="o">=</span> <span class="no">Infrastructure</span><span class="o">::</span><span class="no">TaskRepo</span><span class="p">.</span><span class="nf">all</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="c1"># GET /tasks/1</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">show</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="c1"># GET /tasks/new</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">new</span>
<span class="err">   </span><span class="vi">@task</span> <span class="o">=</span> <span class="no">Core</span><span class="o">::</span><span class="no">Task</span><span class="p">.</span><span class="nf">new</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="c1"># GET /tasks/1/edit</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">edit</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="c1"># POST /tasks</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">create</span>
<span class="err">   </span><span class="k">begin</span>
<span class="err">     </span><span class="vi">@task</span> <span class="o">=</span> <span class="no">Core</span><span class="o">::</span><span class="no">Task</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
<span class="err">     </span><span class="no">Infrastructure</span><span class="o">::</span><span class="no">TaskRepo</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="vi">@task</span><span class="p">)</span>

<span class="err">     </span><span class="n">redirect_to</span> <span class="n">task_url</span><span class="p">(</span><span class="vi">@task</span><span class="p">.</span><span class="nf">db_id</span><span class="p">),</span> <span class="ss">notice: </span><span class="s1">'Task was successfully created.'</span>

<span class="err">   </span><span class="k">rescue</span> <span class="no">ArgumentError</span>
<span class="err">     </span><span class="n">render</span> <span class="ss">:new</span>
<span class="err">   </span><span class="k">end</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="c1"># PATCH/PUT /tasks/1</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">update</span>
<span class="err">   </span><span class="k">begin</span>
<span class="err">     </span><span class="vi">@task</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">task_params</span><span class="p">)</span>
<span class="err">     </span><span class="no">Infrastructure</span><span class="o">::</span><span class="no">TaskRepo</span><span class="p">.</span><span class="nf">save</span><span class="p">(</span><span class="vi">@task</span><span class="p">)</span>

<span class="err">     </span><span class="n">redirect_to</span> <span class="n">task_url</span><span class="p">(</span><span class="vi">@task</span><span class="p">.</span><span class="nf">db_id</span><span class="p">),</span> <span class="ss">notice: </span><span class="s1">'Task was successfully updated.'</span>

<span class="err">   </span><span class="k">rescue</span> <span class="no">ArgumentError</span>
<span class="err">     </span><span class="n">render</span> <span class="ss">:edit</span>
<span class="err">   </span><span class="k">end</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="c1"># DELETE /tasks/1</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">destroy</span>
<span class="err">   </span><span class="no">Infrastructure</span><span class="o">::</span><span class="no">TaskRepo</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="vi">@task</span><span class="p">)</span>
<span class="err">   </span><span class="n">redirect_to</span> <span class="n">tasks_url</span><span class="p">,</span> <span class="ss">notice: </span><span class="s1">'Task was successfully destroyed.'</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="kp">private</span>
<span class="err">   </span><span class="k">def</span> <span class="nf">set_task</span>
<span class="err">     </span><span class="vi">@task</span> <span class="o">=</span> <span class="no">Infrastructure</span><span class="o">::</span><span class="no">TaskRepo</span><span class="p">.</span><span class="nf">load</span><span class="p">(</span><span class="n">params</span><span class="p">[</span><span class="ss">:id</span><span class="p">])</span>
<span class="err">     </span><span class="vi">@task</span><span class="p">.</span><span class="nf">notify_when_done</span> <span class="k">do</span> <span class="o">|</span><span class="n">task</span><span class="o">|</span>
<span class="err">       </span><span class="no">TwitterClient</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="nf">description</span><span class="p">)</span>
<span class="err">     </span><span class="k">end</span>
<span class="err">   </span><span class="k">end</span>

<span class="err">   </span><span class="c1"># Never trust parameters from the scary internet, only allow the white list through.</span>
<span class="err">   </span><span class="k">def</span> <span class="nf">task_params</span>
<span class="err">     </span><span class="n">params</span><span class="p">.</span><span class="nf">permit</span><span class="p">(</span><span class="ss">:description</span><span class="p">,</span> <span class="ss">:done</span><span class="p">)</span>
<span class="err">   </span><span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>The controller is now dealing both with the Twitter connection and the database. This is visible in the controller test :</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'rails_helper'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">describe</span> <span class="no">TasksController</span><span class="p">,</span> <span class="ss">type: :controller</span> <span class="k">do</span>

<span class="err"> </span><span class="n">before</span> <span class="ss">:each</span> <span class="k">do</span>
<span class="err">   </span><span class="n">allow</span><span class="p">(</span><span class="no">TwitterClient</span><span class="o">::</span><span class="no">Client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:update</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>

<span class="err">  </span><span class="c1"># ...</span>

<span class="err"> </span><span class="n">describe</span> <span class="s2">"PUT #update"</span> <span class="k">do</span>
<span class="err">   </span><span class="n">context</span> <span class="s2">"with valid params"</span> <span class="k">do</span>
<span class="err">     </span><span class="n">let</span><span class="p">(</span><span class="ss">:new_attributes</span><span class="p">)</span> <span class="p">{</span>
<span class="err">       </span><span class="p">{</span><span class="ss">done: </span><span class="kp">true</span><span class="p">}</span>
<span class="err">     </span><span class="p">}</span>

<span class="err">     </span><span class="n">it</span> <span class="s2">"updates the requested task"</span> <span class="k">do</span>
<span class="err">       </span><span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">create!</span> <span class="n">valid_attributes</span>
<span class="err">       </span><span class="n">put</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">params: </span><span class="n">new_attributes</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">id: </span><span class="n">task</span><span class="p">.</span><span class="nf">to_param</span><span class="p">)</span>
<span class="err">       </span><span class="n">task</span><span class="p">.</span><span class="nf">reload</span>
<span class="err">       </span><span class="n">expect</span><span class="p">(</span><span class="n">task</span><span class="p">).</span><span class="nf">to</span> <span class="n">be_done</span>
<span class="err">     </span><span class="k">end</span>

<span class="err">     </span><span class="n">it</span> <span class="s2">"tweets about completed tasks"</span> <span class="k">do</span>
<span class="err">       </span><span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">create!</span> <span class="n">valid_attributes</span>

<span class="err">       </span><span class="n">expect</span><span class="p">(</span><span class="no">TwitterClient</span><span class="o">::</span><span class="no">Client</span><span class="p">).</span><span class="nf">to</span> <span class="n">receive</span><span class="p">(</span><span class="ss">:update</span><span class="p">).</span><span class="nf">with</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="nf">description</span><span class="p">)</span>

<span class="err">       </span><span class="n">put</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">params: </span><span class="p">{</span><span class="ss">id: </span><span class="n">task</span><span class="p">.</span><span class="nf">to_param</span><span class="p">,</span> <span class="ss">done: </span><span class="kp">true</span><span class="p">}</span>
<span class="err">     </span><span class="k">end</span>

<span class="err">     </span><span class="n">it</span> <span class="s2">"redirects to the task"</span> <span class="k">do</span>
<span class="err">       </span><span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">create!</span> <span class="n">valid_attributes</span>
<span class="err">       </span><span class="n">put</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">params: </span><span class="n">valid_attributes</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="ss">id: </span><span class="n">task</span><span class="p">.</span><span class="nf">to_param</span><span class="p">)</span>
<span class="err">       </span><span class="n">expect</span><span class="p">(</span><span class="n">response</span><span class="p">).</span><span class="nf">to</span> <span class="n">redirect_to</span><span class="p">(</span><span class="n">task_url</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="nf">id</span><span class="p">))</span>
<span class="err">     </span><span class="k">end</span>
<span class="err">   </span><span class="k">end</span>

<span class="err">   </span><span class="c1"># ... </span>

<span class="err">  </span><span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>We need to <a href="https://blog.pragmatists.com/test-doubles-fakes-mocks-and-stubs-1a7491dfa3da">stub out</a> the twitter API for most tests. We are also still using a mock to verify that the tweet is sent. Finally, as we can see from the test execution times, we are still using the database in some tests.</p>

<p><img src="https://philippe.bourgau.net/imgs/2018-05-28-get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/test-timings.jpg" alt="Screen capture of the tests execution time" /></p>

<p>If the project grew large this would become an issue. Sadly, mocking is often the fix people jump on …</p>

<blockquote>
  <p>💡 Mocking is the unfortunate quick fix to slow tests.</p>
</blockquote>

<p>From a mocking point of view, our current controller test can seem worse than before ! There’s something pretty effective we can do though !</p>

<h2 id="in-memory-fakes">In memory fakes</h2>

<p>Instead of stubbing and mocking in every test, let’s write a full fledged in-memory <a href="https://blog.pragmatists.com/test-doubles-fakes-mocks-and-stubs-1a7491dfa3da">fake</a> that does the job we need. We could then install it once and for all, and forget about it !</p>

<p>Actually, this is nothing new. This is exactly what Rails provides out of the box with <code class="language-plaintext highlighter-rouge">ActionMailer::Base.delivery_method = :test</code>.</p>

<p>Here’s how we could do the same thing for our Twitter Client.</p>

<h6 id="specrails_helperrb">spec/rails_helper.rb</h6>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">class</span> <span class="nc">FakeTwitterClient</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">initialize</span>
<span class="err">   </span><span class="vi">@tweets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="nb">attr_accessor</span> <span class="ss">:tweets</span>

<span class="err"> </span><span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err">   </span><span class="vi">@tweets</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>
<span class="k">end</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>

<span class="err">  </span><span class="c1"># ...</span>
<span class="err"> </span><span class="n">config</span><span class="p">.</span><span class="nf">before</span><span class="p">(</span><span class="ss">:each</span><span class="p">)</span> <span class="k">do</span>
<span class="err">   </span><span class="n">stub_const</span><span class="p">(</span><span class="s2">"TwitterClient::Client"</span><span class="p">,</span> <span class="no">FakeTwitterClient</span><span class="p">.</span><span class="nf">new</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

<h6 id="speccontrollerstasks_controller_specrb">spec/controllers/tasks_controller_spec.rb</h6>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="n">it</span> <span class="s2">"tweets about completed tasks"</span> <span class="k">do</span>
<span class="err"> </span><span class="n">task</span> <span class="o">=</span> <span class="no">Task</span><span class="p">.</span><span class="nf">create!</span> <span class="n">valid_attributes</span>

<span class="err"> </span><span class="n">put</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">params: </span><span class="p">{</span><span class="ss">id: </span><span class="n">task</span><span class="p">.</span><span class="nf">to_param</span><span class="p">,</span> <span class="ss">done: </span><span class="kp">true</span><span class="p">}</span>

<span class="err"> </span><span class="n">expect</span><span class="p">(</span><span class="no">TwitterClient</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">tweets</span><span class="p">).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">task</span><span class="p">.</span><span class="nf">description</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div></div>

<p>Simple isn’t it ?</p>

<h2 id="wait-a-sec-">Wait a sec …</h2>

<p>There’s a catch though … How do we make sure that this fake is behaving the same way as the real thing ?</p>

<p>Let’s run the same tests on both ! We could mimic the twitter API in our fake, but that might not be a great idea. Do you remember the moto “Always wrap your 3rd parties” ? It takes all its meaning here, for 2 reasons.</p>

<p>The first is to make faking easier. We can build a minimal wrapper API that is just enough for our use. By keeping this interface small, we’ll make it a lot easier to fake.</p>

<p>The second reason is that we can write real integration tests on the 3rd party through this wrapper. They’d look like ordinary unit tests, except that they’d end up calling the real 3rd party in a sandbox. They are usually pretty slow, but as 3rd parties don’t change everyday, that’s ok. We can ensure up-front that integration will go well. As a bonus, we can be very fast to detect and contain changes to online services. (I’m looking at you <a href="https://en.wikipedia.org/wiki/Web_scraping">Scrappers</a>!)</p>

<p>Here is what it would look like for our Twitter client :</p>

<h6 id="libinfrastructuretwitter_clientrb">lib/infrastructure/twitter_client.rb</h6>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="k">class</span> <span class="nc">FakeTwitterClient</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">initialize</span>
<span class="err">   </span><span class="vi">@tweets</span> <span class="o">=</span> <span class="p">[]</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="nb">attr_accessor</span> <span class="ss">:tweets</span>

<span class="err"> </span><span class="k">def</span> <span class="nf">tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err">   </span><span class="vi">@tweets</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="k">def</span> <span class="nf">search_tweets</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="err">   </span><span class="vi">@tweets</span><span class="p">.</span><span class="nf">select</span> <span class="p">{</span><span class="o">|</span><span class="n">tweet</span><span class="o">|</span> <span class="n">tweet</span><span class="p">.</span><span class="nf">include?</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="p">}</span>
<span class="err"> </span><span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">RealTwitterClient</span>
<span class="err"> </span><span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
<span class="err">   </span><span class="vi">@client</span> <span class="o">=</span> <span class="no">Twitter</span><span class="o">::</span><span class="no">REST</span><span class="o">::</span><span class="no">Client</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="o">&amp;</span><span class="n">block</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="k">def</span> <span class="nf">tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err">   </span><span class="vi">@client</span><span class="p">.</span><span class="nf">update</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>

<span class="err"> </span><span class="k">def</span> <span class="nf">search_tweets</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
<span class="err">   </span><span class="vi">@client</span><span class="p">.</span><span class="nf">search</span><span class="p">(</span><span class="s2">"from:test_user </span><span class="si">#{</span><span class="n">text</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>
<span class="k">end</span>

</code></pre></div></div>

<p>As you can see, we renamed <code class="language-plaintext highlighter-rouge">update</code> to <code class="language-plaintext highlighter-rouge">tweet</code> in the wrapper. We’d have to update the calls accordingly. Let’s look at the tests.</p>

<h6 id="speclibinfrastructuretwitter_client_specrb">spec/lib/Infrastructure/twitter_client_spec.rb</h6>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="nb">require</span> <span class="s1">'rails_helper'</span>
<span class="nb">require</span> <span class="s1">'infrastructure/twitter_client'</span>
<span class="nb">require</span> <span class="s1">'securerandom'</span>

<span class="no">RSpec</span><span class="p">.</span><span class="nf">shared_examples</span> <span class="s2">"a twitter client"</span> <span class="k">do</span> <span class="o">|</span><span class="n">new_client_instance</span><span class="o">|</span>
<span class="err"> </span><span class="n">let</span><span class="p">(</span><span class="ss">:client</span><span class="p">)</span> <span class="p">{</span> <span class="n">new_client_instance</span> <span class="p">}</span>
<span class="err"> </span><span class="n">it</span> <span class="s2">"sends tweets"</span> <span class="k">do</span>
<span class="err">   </span><span class="n">token</span> <span class="o">=</span> <span class="no">SecureRandom</span><span class="p">.</span><span class="nf">uuid</span>
<span class="err">   </span><span class="n">message</span> <span class="o">=</span> <span class="s2">"Philippe was here </span><span class="si">#{</span><span class="n">token</span><span class="si">}</span><span class="s2">"</span>
<span class="err">   </span><span class="n">client</span><span class="p">.</span><span class="nf">tweet</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

<span class="err">   </span><span class="n">expect</span><span class="p">(</span><span class="n">client</span><span class="p">.</span><span class="nf">search_tweets</span><span class="p">(</span><span class="n">token</span><span class="p">)).</span><span class="nf">to</span> <span class="kp">include</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="err"> </span><span class="k">end</span>
<span class="k">end</span>

<span class="n">context</span> <span class="no">FakeTwitterClient</span> <span class="k">do</span>
<span class="err"> </span><span class="n">it_behaves_like</span> <span class="s2">"a twitter client"</span><span class="p">,</span> <span class="no">FakeTwitterClient</span><span class="p">.</span><span class="nf">new</span>
<span class="k">end</span>

<span class="n">context</span> <span class="no">RealTwitterClient</span><span class="p">,</span> <span class="ss">integration: </span><span class="kp">true</span><span class="p">,</span> <span class="ss">speed: :slow</span> <span class="k">do</span>
<span class="err"> </span><span class="n">it_behaves_like</span> <span class="s2">"a twitter client"</span><span class="p">,</span> <span class="p">(</span><span class="no">RealTwitterClient</span><span class="p">.</span><span class="nf">new</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>
<span class="err">   </span><span class="n">config</span><span class="p">.</span><span class="nf">consumer_key</span> <span class="err">       </span><span class="o">=</span> <span class="s2">"TEST_CONSUMER_KEY"</span>
<span class="err">   </span><span class="n">config</span><span class="p">.</span><span class="nf">consumer_secret</span> <span class="err">    </span><span class="o">=</span> <span class="s2">"TEST_CONSUMER_SECRET"</span>
<span class="err">   </span><span class="n">config</span><span class="p">.</span><span class="nf">access_token</span> <span class="err">       </span><span class="o">=</span> <span class="s2">"TEST_ACCESS_TOKEN"</span>
<span class="err">   </span><span class="n">config</span><span class="p">.</span><span class="nf">access_token_secret</span> <span class="o">=</span> <span class="s2">"TEST_ACCESS_SECRET"</span>
<span class="err"> </span><span class="k">end</span><span class="p">)</span>
<span class="k">end</span>

</code></pre></div></div>

<p>We had to add a search method to our interface for the sake of testing. This should remain “For testing only”. We’d also adapt the controller test to use this <code class="language-plaintext highlighter-rouge">search_tweets</code> method.</p>

<p>Let’s look at where we stand now. We’re injecting each mock only once. Tests are fast yet straightforward, almost as if they were testing the real thing. Doing so, we’ve split our system in cohesive parts and we’ve wrapped our 3rd parties. We’ve actually done a lot more than removing mocks ! <a href="https://medium.com/javascript-scene/mocking-is-a-code-smell-944a70c90a6a">Mocking really is a design smell</a>.</p>

<blockquote>
  <p>💡 Merciless mock hunting will improve the design of your system !</p>
</blockquote>

<h2 id="last-word-about-implementation">Last word about implementation</h2>

<p>Sometimes, this 3rd party wrapper can become pretty complicated. Try to reuse as much of it as possible between the real and the fake. For example, an <a href="https://en.wikipedia.org/wiki/Object-relational_mapping">ORM</a>, like ActiveRecord for example, is a wrapper around the database. Reimplementing a fake ORM would be real challenge. We’re far better <a href="https://philippe.bourgau.net/5-minutes-hack-to-speed-up-rspec-in-rails-5-using-in-memory-sqlite/">plugin it on top of SQLite</a> instead !</p>

<h2 id="references">References</h2>

<p>Smart people have already spoken and written about this subject. If you want to learn more, I recommend that you have a look at <a href="https://twitter.com/aslak_hellesoy">Aslak Hellesøy</a>’s <a href="https://skillsmatter.com/skillscasts/9971-testable-software-architecture-with-aslak-hellesoy">Testable Architecture talk</a>. <a href="http://www.jamesshore.com/">James Shore</a>, the author of <a href="https://www.amazon.com/Art-Agile-Development-Pragmatic-Software/dp/0596527675/ref=sr_1_1?ie=UTF8&amp;qid=1527568833&amp;sr=8-1&amp;keywords=the+art+of+agile+development">The Art of Agile Development</a>, also wrote a pattern language called <a href="http://www.jamesshore.com/Blog/Testing-Without-Mocks.html">Testing Without Mock</a>.</p>

<h2 id="next-week">Next week</h2>

<p>This was the 7th blog post in <a href="https://philippe.bourgau.net/categories/#how-to-avoid-mocks-series">a series about how to avoid mocks</a>. Hopefully, I’m reaching the end ! <a href="https://philippe.bourgau.net/when-is-testing-using-mocks-still-a-good-idea/">Next week’s post</a> should be the last in series, and deal with a few remaining points. What to do when you really need a mock ? What about mocking and legacy code ?</p>


<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<div id="mc_embed_signup">
  <form action="https://bourgau.us18.list-manage.com/subscribe/post?u=b46bc99339f9c9f337232c617&amp;id=ed63184b0e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
        <label for="mce-EMAIL">Stay up to date with content and upcoming products</label>
        <p>I usually write about 15 minutes worth of reading per month. I won't transfer your email. No Spam, unsubscribe whenever you want.</p>
        <p><em>As a gift for subscribing, you'll receive an illustrated mini-ebook <strong>"How to start a team coding dojo"</strong>!</em></p>
        <p><img src="/imgs/thumbnails/how-to-start-your-team-coding-dojo-cover.jpg"/></p>
        <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
        <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
        <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_b46bc99339f9c9f337232c617_ed63184b0e" tabindex="-1" value=""></div>
        <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
  </form>
</div>

<!--End mc_embed_signup-->

        
      </section>

      <footer class="page__meta">
        
        


  


  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      <a href="/categories/#architecture" class="page__taxonomy-item" rel="tag">architecture</a><span class="sep">, </span>
    
      <a href="/categories/#how-to-avoid-mocks-series" class="page__taxonomy-item" rel="tag">how-to-avoid-mocks-series</a><span class="sep">, </span>
    
      <a href="/categories/#mocking" class="page__taxonomy-item" rel="tag">mocking</a><span class="sep">, </span>
    
      <a href="/categories/#programming" class="page__taxonomy-item" rel="tag">programming</a><span class="sep">, </span>
    
      <a href="/categories/#ruby" class="page__taxonomy-item" rel="tag">ruby</a><span class="sep">, </span>
    
      <a href="/categories/#tdd" class="page__taxonomy-item" rel="tag">tdd</a><span class="sep">, </span>
    
      <a href="/categories/#testing" class="page__taxonomy-item" rel="tag">testing</a>
    
    </span>
  </p>


        

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2018-05-31T19:15:00+00:00">May 31, 2018</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=pbourgau&text=Get+rid+of+mock+maintenance+with+full+fledged+in-memory+fakes%20https%3A%2F%2Fphilippe.bourgau.net%2Fget-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>


  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fphilippe.bourgau.net%2Fget-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>

  <a href="https://www.reddit.com/submit?url=https%3A%2F%2Fphilippe.bourgau.net%2Fget-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes%2F&title=Get+rid+of+mock+maintenance+with+full+fledged+in-memory+fakes" class="btn" style="background-color: #ff4500; color: white" title="Share on Reddit"><i class="fab fa-fw fa-reddit" aria-hidden="true"></i><span> Reddit</span></a>

  <a href="http://news.ycombinator.com/submitlink?u=https%3A%2F%2Fphilippe.bourgau.net%2Fget-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes%2F&t=Get rid of mock maintenance with full fledged in-memory fakes" class="btn" style="background-color: #ff6600; color: white"  title="Share on Hackernews"><i class="fab fa-fw fa-hacker-news" aria-hidden="true"></i><span> Hacker News</span></a>

</section>


      
  <nav class="pagination">
    
      <a href="/avoid-mocks-and-test-your-core-domain-faster-with-hexagonal-architecture/" class="pagination--pager" title="Avoid mocks and test your core domain faster with Hexagonal Architecture
">Previous</a>
    
    
      <a href="/when-is-testing-using-mocks-still-a-good-idea/" class="pagination--pager" title="When is testing using mocks still a good idea ?
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/imgs/2023-11-07-the-secrets-of-tech-coaching-better-communication-skill/human-human-stack-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/the-secrets-of-tech-coaching-better-communication-skill/" rel="permalink">The Secrets Of Tech Coaching: Better Communication Skill
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          17 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Running code katas or mobs with groups that lack teamwork is almost impossible! Here are 20 communication and collaboration techniques to coach by example.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/imgs/2023-07-22-liberating-structures-the-slow-code-retreat-s-little-facilitation-secret/snail-carrying-liberating-structures-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/liberating-structures-the-slow-code-retreat-s-little-facilitation-secret/" rel="permalink">Liberating Structures: the Slow Code Retreat’s little facilitation secret
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          6 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">You can now run the Slow Code Retreat by following the facilitation guide. By doing so, you’ll also learn 6 Liberating Structures for your future workshops.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/imgs/2023-06-04-how-to-fix-bad-agile-by-discussing-baby-steps/baby-steps-aha-moment-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/how-to-fix-bad-agile-by-discussing-baby-steps/" rel="permalink">How To Fix Bad Agile By Discussing Baby Steps
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          5 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">How to fix bad agile by starting neutral discussions about baby-steps programming. Baby steps are a sustainable and productive approach to writing code.
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/imgs/2023-04-26-a-quality-view-workshop-to-discuss-technical-excellence/missing-a-quality-view-teaser.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/a-quality-view-workshop-to-discuss-technical-excellence/" rel="permalink">A Quality View Workshop to Discuss Technical Excellence
</a>
      
    </h2>
    

  <p class="page__meta">
    

    

    
      
      

      <span class="page__meta-readtime">
        <i class="far fa-clock" aria-hidden="true"></i>
        
          17 minute read
        
      </span>
    
  </p>


    <p class="archive__item-excerpt" itemprop="description">Here is a step-by-step workshop to guide a team to drawing a Quality View. Use it to discuss investment in agile technical excellence with stakeholders.
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://twitter.com/pbourgau" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i> Twitter</a></li>
        
      
        
      
        
          <li><a href="https://github.com/philou" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
        
      
        
      
        
      
        
          <li><a href="https://www.linkedin.com/in/philippe-bourgau-607a928" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i> LinkedIn</a></li>
        
      
        
          <li><a href="http://eepurl.com/dxKE95" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope" aria-hidden="true"></i> Mail Feed</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2024 Philippe Bourgau. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0XLKP12EJF"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0XLKP12EJF', { 'anonymize_ip': true});
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://philippe.bourgau.net/get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/get-rid-of-mocking-maintenance-with-full-fledged-in-memory-fakes"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://philippe-bourgau.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
